package vista;

import controlador.gestorPartidas;
import controlador.gestorTablero;
import javafx.fxml.FXML;
import javafx.fxml.FXMLLoader;
import javafx.scene.Parent;
import javafx.scene.Scene;
import javafx.scene.control.Spinner;
import javafx.scene.control.SpinnerValueFactory;
import javafx.stage.Stage;
import modelo.Inventario;
import modelo.Jugador;
import modelo.Pinguino;

import java.util.ArrayList;
import java.util.List;

public class pantallaSeleccionJugadoresController {

    @FXML private Spinner<Integer> spinnerNumJugadores;

    @FXML
    public void initialize() {
        // Rango 1–4, valor inicial 1
        spinnerNumJugadores.setValueFactory(
            new SpinnerValueFactory.IntegerSpinnerValueFactory(1, 4, 1)
        );
    }

    @FXML
    private void handleEjecutar() {
        int num = spinnerNumJugadores.getValue();

        try {
            // 1) Crear dinámicamente la lista de jugadores
            List<Jugador> jugadores = new ArrayList<>();
            String[] colores = {"Azul", "Rojo", "Verde", "Amarillo"};
            for (int i = 0; i < num; i++) {
                // posición inicial 0, nombre Jugador 1–n, color según índice
                jugadores.add(new Pinguino(
                    0,
                    "Jugador " + (i + 1),
                    colores[i],
                    new Inventario(new ArrayList<>())
                ));
            }

            // 2) Inicializar el tablero y la partida
            gestorTablero gTab = new gestorTablero();
            gestorPartidas gp = new gestorPartidas(gTab, jugadores);

            // 3) Cargar la vista de juego
            FXMLLoader loader = new FXMLLoader(
                getClass().getResource("/pantallaJuego.fxml")
            );
            Parent root = loader.load();

            // 4) Pasar datos al controlador de pantalla de juego
            vista.pantallaJuegoController ctrl = loader.getController();
            ctrl.setNumeroJugadores(num);
            ctrl.setGestorPartidas(gp);

            // 5) Mostrar ventana de juego
            Stage stage = new Stage();
            stage.setTitle("Pantalla de Juego");
            stage.setScene(new Scene(root));
            stage.show();

            // 6) Cerrar ventana de selección
            spinnerNumJugadores.getScene().getWindow().hide();

        } catch (Exception ex) {
            ex.printStackTrace();
        }
    }
}
